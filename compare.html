<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compare Careers | CareerData</title>

    <link rel="stylesheet" href="css/design-tokens.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/charts.css">
    <link rel="stylesheet" href="css/responsive.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        .compare-header {
            padding: var(--space-8) 0;
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border-subtle);
        }

        .career-selector {
            display: flex;
            gap: var(--space-4);
            margin-top: var(--space-6);
            flex-wrap: wrap;
        }

        .career-selector-slot {
            flex: 1;
            min-width: 250px;
            padding: var(--space-4);
            background: var(--color-surface-card);
            border: 2px dashed var(--color-border-default);
            border-radius: var(--radius-xl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-all);
        }

        .career-selector-slot:hover {
            border-color: var(--color-accent-primary);
            background: var(--color-bg-elevated);
        }

        .career-selector-slot.filled {
            border-style: solid;
            text-align: left;
        }

        .career-selector-slot.filled-0 {
            border-color: var(--color-chart-1);
        }

        .career-selector-slot.filled-1 {
            border-color: var(--color-chart-2);
        }

        .career-selector-slot.filled-2 {
            border-color: var(--color-chart-3);
        }

        .career-selector-slot.filled-3 {
            border-color: var(--color-chart-4);
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .slot-remove {
            background: transparent;
            border: none;
            color: var(--color-text-tertiary);
            cursor: pointer;
            font-size: 18px;
        }

        .slot-remove:hover {
            color: var(--color-error);
        }

        .comparison-content {
            padding: var(--space-8) 0;
        }

        .comparison-section {
            margin-bottom: var(--space-8);
        }

        .comparison-section-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-4);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: var(--space-3) var(--space-4);
            text-align: left;
            border-bottom: 1px solid var(--color-border-subtle);
        }

        .comparison-table th {
            background: var(--color-bg-elevated);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-tertiary);
        }

        .comparison-table th:first-child {
            border-radius: var(--radius-lg) 0 0 0;
        }

        .comparison-table th:last-child {
            border-radius: 0 var(--radius-lg) 0 0;
        }

        .comparison-table td:first-child {
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            width: 180px;
        }

        .comparison-table tr:hover td {
            background: var(--color-bg-elevated);
        }

        .comparison-table .highlight {
            color: var(--color-success);
            font-weight: var(--font-weight-semibold);
        }

        .comparison-table .highlight::after {
            content: ' ‚úì';
            font-size: 12px;
        }

        .color-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: var(--space-2);
        }

        .comparison-chart-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: var(--space-6);
            margin-top: var(--space-6);
        }

        .quick-verdict {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-top: var(--space-6);
        }

        .verdict-card {
            padding: var(--space-4);
            background: var(--color-surface-card);
            border: 1px solid var(--color-border-subtle);
            border-radius: var(--radius-lg);
            text-align: center;
        }

        .verdict-card h4 {
            font-size: var(--font-size-sm);
            color: var(--color-text-tertiary);
            margin-bottom: var(--space-2);
        }

        .verdict-winner {
            font-weight: var(--font-weight-bold);
            font-size: var(--font-size-lg);
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--color-surface-card);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-lg);
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: var(--shadow-lg);
            display: none;
        }

        .search-dropdown.open {
            display: block;
        }

        .search-dropdown-item {
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--color-border-subtle);
        }

        .search-dropdown-item:hover {
            background: var(--color-bg-elevated);
        }

        .search-dropdown-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .comparison-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="app-header">
            <div class="container flex items-center justify-between h-full">
                <a href="index.html" class="flex items-center gap-2" style="text-decoration: none;">
                    <span style="font-size: 1.5rem;">üìä</span>
                    <span class="font-bold text-lg">CareerData</span>
                </a>

                <nav class="flex items-center gap-6 md-show">
                    <a href="explore.html" class="text-secondary font-medium" style="text-decoration: none;">Explore</a>
                    <a href="compare.html" class="text-accent font-medium" style="text-decoration: none;">Compare</a>
                    <a href="analytics.html" class="text-secondary font-medium"
                        style="text-decoration: none;">Analytics</a>
                </nav>
            </div>
        </header>

        <!-- Compare Header -->
        <section class="compare-header">
            <div class="container">
                <h1 class="h2 mb-2">Compare Careers</h1>
                <p class="text-secondary">Select up to 4 careers to compare side-by-side across all metrics</p>

                <div class="career-selector" id="career-selector">
                    <!-- Dynamic Slots -->
                </div>
            </div>
        </section>

        <!-- Comparison Content -->
        <main class="container comparison-content">

            <!-- Quick Verdict -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üèÜ Quick Verdict</h2>

                <div class="quick-verdict">
                    <div class="verdict-card">
                        <h4>Highest Salary</h4>
                        <div class="verdict-winner" style="color: var(--color-chart-1);">HVAC Technician</div>
                        <div class="text-sm text-secondary">$59,800 median</div>
                    </div>
                    <div class="verdict-card">
                        <h4>Fastest to Start</h4>
                        <div class="verdict-winner" style="color: var(--color-chart-2);">Roofing Contractor</div>
                        <div class="text-sm text-secondary">1-2 months</div>
                    </div>
                    <div class="verdict-card">
                        <h4>Highest Growth</h4>
                        <div class="verdict-winner" style="color: var(--color-chart-1);">HVAC Technician</div>
                        <div class="text-sm text-secondary">+6% 10-year</div>
                    </div>
                    <div class="verdict-card">
                        <h4>Lowest Barrier</h4>
                        <div class="verdict-winner" style="color: var(--color-chart-2);">Roofing Contractor</div>
                        <div class="text-sm text-secondary">T0 - Owner Now</div>
                    </div>
                </div>
            </section>

            <!-- Basic Info Comparison -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üìã Basic Information</h2>

                <table class="comparison-table basics-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <!-- Dynamic Headers -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic Body -->
                    </tbody>
                </table>
            </section>

            <!-- Compensation Comparison -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üí∞ Compensation</h2>

                <table class="comparison-table comp-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <!-- Dynamic Headers -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic Body -->
                    </tbody>
                </table>

                <div class="comparison-chart-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4 class="chart-title">Salary Comparison</h4>
                        </div>
                        <div class="chart-wrapper" style="height: 250px;">
                            <canvas id="salary-comparison-chart"></canvas>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h4 class="chart-title">Salary by Experience</h4>
                        </div>
                        <div class="chart-wrapper" style="height: 250px;">
                            <canvas id="experience-comparison-chart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            </table>
            </section>

            </table>
            </section>

            <!-- Business Comparison -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üè¢ Business Ownership</h2>

                <table class="comparison-table biz-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <!-- Dynamic Headers -->
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic Body -->
                    </tbody>
                </table>
            </section>

            <!-- Work Environment Comparison -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üõ†Ô∏è Work Environment</h2>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Factor</th>
                            <th><span class="color-indicator" style="background: var(--color-chart-1);"></span>HVAC
                                Technician</th>
                            <th><span class="color-indicator" style="background: var(--color-chart-2);"></span>Roofing
                                Contractor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Physical Demand Level</td>
                            <td class="highlight">4/5 (Heavy)</td>
                            <td>5/5 (Very Heavy)</td>
                        </tr>
                        <tr>
                            <td>Injury Rate (per 1000)</td>
                            <td class="highlight">4.2</td>
                            <td>29.9</td>
                        </tr>
                        <tr>
                            <td>On-Call Required</td>
                            <td>Yes (rotating)</td>
                            <td class="highlight">No</td>
                        </tr>
                        <tr>
                            <td>Weather Dependency</td>
                            <td class="highlight">Low</td>
                            <td>High</td>
                        </tr>
                        <tr>
                            <td>Job Satisfaction</td>
                            <td class="highlight">72/100</td>
                            <td>68/100</td>
                        </tr>
                    </tbody>
                </table>

                <!-- Hidden for now until we have dynamic skills data -->
                <div class="comparison-chart-row" style="display: none;">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h4 class="chart-title">Skills Comparison</h4>
                        </div>
                        <div style="display: flex; justify-content: center; align-items: center; height: 300px;">
                            <canvas id="skills-radar-chart" style="max-width: 350px; max-height: 350px;"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market Outlook Comparison -->
            <section class="comparison-section">
                <h2 class="comparison-section-title">üìà Market Outlook</h2>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th><span class="color-indicator" style="background: var(--color-chart-1);"></span>HVAC
                                Technician</th>
                            <th><span class="color-indicator" style="background: var(--color-chart-2);"></span>Roofing
                                Contractor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>US Employment</td>
                            <td class="highlight">394,200</td>
                            <td>156,800</td>
                        </tr>
                        <tr>
                            <td>10-Year Growth</td>
                            <td class="highlight">+6%</td>
                            <td>+4%</td>
                        </tr>
                        <tr>
                            <td>Annual Openings</td>
                            <td class="highlight">34,800</td>
                            <td>15,100</td>
                        </tr>
                        <tr>
                            <td>Automation Risk</td>
                            <td>Low (15%)</td>
                            <td class="highlight">Very Low (5%)</td>
                        </tr>
                        <tr>
                            <td>Self-Employment Rate</td>
                            <td>12%</td>
                            <td class="highlight">14%</td>
                        </tr>
                    </tbody>
                </table>
            </section>

        </main>

        <!-- Search Modal -->
        <div id="compare-search-modal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: var(--color-surface-card); width: 90%; max-width: 600px; max-height: 80vh; border-radius: var(--radius-xl); display: flex; flex-direction: column; overflow: hidden;">
                <div
                    style="padding: var(--space-4); border-bottom: 1px solid var(--color-border-subtle); display: flex; justify-content: space-between; align-items: center;">
                    <h3 class="h4 m-0">Select Career to Compare</h3>
                    <button onclick="closeSearch()"
                        style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">√ó</button>
                </div>
                <div style="padding: var(--space-4);">
                    <input type="text" id="career-search-input" placeholder="Search careers..."
                        style="width: 100%; padding: var(--space-3); border-radius: var(--radius-lg); border: 1px solid var(--color-border-default); background: var(--color-bg-elevated); color: var(--color-text-primary);">
                </div>
                <div id="search-results" style="flex: 1; overflow-y: auto; padding: 0 var(--space-4) var(--space-4);">
                    <!-- Results -->
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container text-center">
                <p class="text-sm text-tertiary">
                    Data sourced from BLS, O*NET, and state licensing boards. Last updated: December 2024.
                </p>
            </div>
        </footer>
    </div>

    <!-- Data Scripts -->
    <script src="js/careers-data.js"></script>
    <script src="js/careers-data-t1-part1.js"></script>
    <script src="js/careers-data-t1-part2.js"></script>
    <script src="js/careers-data-t1-part3.js"></script>
    <script src="js/careers-data-t2.js"></script>
    <script src="js/careers-data-t3.js"></script>
    <script src="js/careers-data-t4.js"></script>
    <script src="js/careers-data-t5.js"></script>

    <script src="js/charts.js"></script>
    <script>
        let allCareers = [];
        let compareIds = [];
        let activeSlot = -1;

        document.addEventListener('DOMContentLoaded', function () {
            // Load Data
            if (window.CAREERS_DATA) {
                allCareers = Object.entries(window.CAREERS_DATA).map(([id, c]) => {
                    c.id = id;
                    c.salaryMedian = c.salary ? c.salary.median : 0;
                    c.salaryTop10 = c.salary ? c.salary.top10 : 0;
                    c.timeVal = parseTimeVal(c.timeToOwn);
                    return c;
                });
            }

            // Parse URL
            const urlParams = new URLSearchParams(window.location.search);
            const compareParam = urlParams.get('compare');
            if (compareParam) {
                compareIds = compareParam.split(',').filter(id => window.CAREERS_DATA && window.CAREERS_DATA[id]).slice(0, 4);
            } else {
                // Default to a sample comparison if empty
                compareIds = ['residential-hvac-replacement', 'roofing-retail-'];
            }

            renderAll();

            // Search Input
            document.getElementById('career-search-input').addEventListener('input', function (e) {
                renderSearchResults(e.target.value);
            });
        });

        function renderAll() {
            renderSelector();
            renderComparisonTable();
            renderCharts();
            updateUrl();
        }

        function updateUrl() {
            const url = new URL(window.location);
            if (compareIds.length > 0) {
                url.searchParams.set('compare', compareIds.join(','));
            } else {
                url.searchParams.delete('compare');
            }
            window.history.replaceState({}, '', url);
        }

        // --- Selector ---
        function renderSelector() {
            const container = document.getElementById('career-selector');
            container.innerHTML = '';

            // Render 4 slots (filled or empty)
            for (let i = 0; i < 4; i++) {
                const id = compareIds[i];
                if (id) {
                    const c = window.CAREERS_DATA[id];
                    container.innerHTML += `
                    <div class="career-selector-slot filled filled-${i}" data-slot="${i}">
                        <div class="slot-header">
                            <div>
                                <span class="tier-badge tier-badge-${c.tier} mb-2">T${c.tier}</span>
                                <h3 class="font-semibold">${c.name}</h3>
                                <span class="text-sm text-secondary">${c.category}</span>
                            </div>
                            <button class="slot-remove" onclick="removeCareer(${i})">√ó</button>
                        </div>
                    </div>`;
                } else {
                    container.innerHTML += `
                    <div class="career-selector-slot" data-slot="${i}" onclick="openCareerSearch(${i})">
                        <div class="text-tertiary">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">+</div>
                            <div>Add Career</div>
                        </div>
                    </div>`;
                }
            }
        }

        function removeCareer(index) {
            compareIds.splice(index, 1);
            renderAll();
        }

        // --- Comparison Tables ---
        function renderComparisonTable() {
            const careers = compareIds.map(id => window.CAREERS_DATA[id]);

            // Helper to build headers
            const buildHeaders = () => {
                let html = '<th>Metric</th>';
                careers.forEach((c, i) => {
                    html += `<th><span class="color-indicator" style="background: var(--color-chart-${i + 1});"></span>${c.name}</th>`;
                });
                return html;
            };

            // Basic Info Header
            document.querySelector('.basics-table thead tr').innerHTML = buildHeaders();

            // Basic Info Body
            document.querySelector('.basics-table tbody').innerHTML = `
                <tr><td>Tier</td>${careers.map(c => `<td>T${c.tier}</td>`).join('')}</tr>
                <tr><td>Category</td>${careers.map(c => `<td>${c.category}</td>`).join('')}</tr>
                <tr><td>Time to Own</td>${careers.map(c => `<td>${c.timeToOwn}</td>`).join('')}</tr>
                <tr><td>Education</td>${careers.map(c => `<td>${c.education ? c.education.min : 'N/A'}</td>`).join('')}</tr>
            `;

            // Compensation Header
            document.querySelector('.comp-table thead tr').innerHTML = buildHeaders();

            // Compensation Body
            document.querySelector('.comp-table tbody').innerHTML = `
                <tr><td>Entry Salary</td>${careers.map(c => `<td>$${(c.salary ? c.salary.entry : 0).toLocaleString()}</td>`).join('')}</tr>
                <tr><td>Median Salary</td>${careers.map(c => `<td><strong style="color: var(--color-success)">$${(c.salary ? c.salary.median : 0).toLocaleString()}</strong></td>`).join('')}</tr>
                <tr><td>Top 10% Salary</td>${careers.map(c => `<td>$${(c.salaryTop10 || 0).toLocaleString()}</td>`).join('')}</tr>
                <tr><td>Growth Outlook</td>${careers.map(c => `<td>${c.growthVal}%</td>`).join('')}</tr>
            `;

            // Timeline/Biz Header
            document.querySelector('.biz-table thead tr').innerHTML = buildHeaders();
            document.querySelector('.biz-table tbody').innerHTML = `
                <tr><td>Startup Cost</td>${careers.map(c => `<td>$${(c.business ? c.business.startupTypical : 0).toLocaleString()}</td>`).join('')}</tr>
                <tr><td>Year 1 Revenue</td>${careers.map(c => `<td>$${(c.business ? c.business.year1Revenue : 0).toLocaleString()}</td>`).join('')}</tr>
                <tr><td>Break Even</td>${careers.map(c => `<td>${c.business ? c.business.breakeven : 'N/A'}</td>`).join('')}</tr>
            `;

            // Verdict
            renderVerdict(careers);
        }

        function renderVerdict(careers) {
            if (careers.length < 2) {
                document.querySelector('.quick-verdict').innerHTML = '<div class="text-center w-100 text-secondary">Select at least 2 careers to see verdict.</div>';
                return;
            }

            // Find winners
            const highestSalary = [...careers].sort((a, b) => b.salaryMedian - a.salaryMedian)[0];
            const fastest = [...careers].sort((a, b) => parseTimeVal(a.timeToOwn) - parseTimeVal(b.timeToOwn))[0];
            const highestGrowth = [...careers].sort((a, b) => b.growthVal - a.growthVal)[0];

            document.querySelector('.quick-verdict').innerHTML = `
                <div class="verdict-card">
                    <h4>Highest Salary</h4>
                    <div class="verdict-winner" style="color: var(--color-chart-1);">${highestSalary.name}</div>
                    <div class="text-sm text-secondary">$${(highestSalary.salaryMedian / 1000).toFixed(1)}k median</div>
                </div>
                <div class="verdict-card">
                    <h4>Fastest to Start</h4>
                    <div class="verdict-winner" style="color: var(--color-chart-2);">${fastest.name}</div>
                    <div class="text-sm text-secondary">${fastest.timeToOwn}</div>
                </div>
                <div class="verdict-card">
                    <h4>Highest Growth</h4>
                    <div class="verdict-winner" style="color: var(--color-chart-3);">${highestGrowth.name}</div>
                    <div class="text-sm text-secondary">+${highestGrowth.growthVal}%</div>
                </div>`;
        }


        // --- Charts ---
        function renderCharts() {
            const careers = compareIds.map(id => window.CAREERS_DATA[id]);
            if (careers.length === 0) return;

            // Salary Column Chart
            Charts.comparisonBar('salary-comparison-chart', {
                labels: ['Entry', 'Median', 'Top 10%'],
                datasets: careers.map((c, i) => ({
                    label: c.name,
                    values: [c.salary.entry, c.salary.median, c.salaryTop10]
                }))
            });

            // Growth Projection (Hypothetical)
            Charts.trendLine('experience-comparison-chart', {
                labels: ['Yr 1', 'Yr 3', 'Yr 5', 'Yr 10'],
                datasets: careers.map((c, i) => {
                    const start = c.salary.entry;
                    const mid = c.salary.median;
                    const peak = c.salaryTop10;
                    return {
                        label: c.name,
                        values: [start, (start + mid) / 2, mid, peak] // Rough curve
                    };
                })
            });
        }


        // --- Search Modal ---
        function openCareerSearch(slot) {
            if (activeSlot !== -1) return; // Already open?
            activeSlot = slot;

            document.getElementById('compare-search-modal').style.display = 'flex';
            document.getElementById('career-search-input').value = '';
            document.getElementById('career-search-input').focus();
            renderSearchResults('');
        }

        function closeSearch() {
            document.getElementById('compare-search-modal').style.display = 'none';
            activeSlot = -1;
        }

        function renderSearchResults(query) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';

            const q = query.toLowerCase();
            const results = allCareers.filter(c =>
                (c.name.toLowerCase().includes(q) || c.category.toLowerCase().includes(q) || c.tier.toString().includes(q))
                && !compareIds.includes(c.id) // Exclude already selected
            ).slice(0, 20); // Limit results

            results.forEach(c => {
                container.innerHTML += `
                 <div class="search-dropdown-item" onclick="selectCareer('${c.id}')">
                    <div>
                        <div class="font-semibold">${c.name}</div>
                        <div class="text-sm text-tertiary">T${c.tier} ‚Ä¢ ${c.category}</div>
                    </div>
                    <div class="text-accent">+</div>
                 </div>`;
            });
        }

        function selectCareer(id) {
            if (activeSlot !== -1) {
                compareIds[activeSlot] = id; // Replace if slot was specific (though our UI pushes to list logic, let's just push if pure add)
                // Actually my toggle logic passed index. 
                // If I clicked an empty slot, `activeSlot` is the index 0-3.
                // If I clicked "Add", I should likely just fill the first available or the index I clicked.
                // My render loop sends 0,1,2,3. So `activeSlot` is the target index.

                // If I am replacing a filled one? The UI doesn't allow clicking filled ones to search, only remove.
                // So activeSlot is always an empty index.

                // wait, array splice? No, `compareIds` is a list. 
                // If I have [A, B] and I click slot 2 (index 2), I am adding C.
                // compareIds[2] = id works.
                compareIds[activeSlot] = id;

                // If I skipped a slot (e.g. have [A] and click slot 3), array becomes [A, empty, empty, D]. 
                // Filter undefined?
                compareIds = compareIds.filter(x => x);

                closeSearch();
                renderAll();
            }
        }

        // --- Helper ---
        function parseTimeVal(timeStr) {
            if (!timeStr) return 0;
            const str = timeStr.toLowerCase();
            if (str.includes('month')) return parseInt(str) || 1;
            if (str.includes('year')) return (parseInt(str) || 1) * 12;
            return 0;
        }

    </script>
</body>

</html>